name: Minikube-in-DinD CI

on:
  push:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    permissions:
      contents: read

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Build DinD image with Minikube
        run: |
          docker build -t minikube-dind:latest -f minikube-dind/Dockerfile .
      
      - name: Run Minikube inside DinD
        run: |
          docker run --privileged --name minikube-dind-instance -d minikube-dind:latest
          # Wait for readiness and test
          docker logs minikube-dind-instance
